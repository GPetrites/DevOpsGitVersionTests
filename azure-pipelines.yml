trigger:
  branches:
    include:
      - develop
      - release
      - master

stages:
  - stage: serverBuild
    displayName: "Server Build"
    dependsOn: []
    pool:
      vmImage: "ubuntu-latest"
    jobs:
      - job: DevOpsBuild
        displayName: "DevOps Build"
        steps:
          - checkout: self
            persistCredentials: true
            fetchDepth: 1

          - task: UseDotNet@2
            displayName: Use .NET 6.0
            inputs:
              packageType: 'sdk'
              version: '6.0.x'
          - task: gitversion/setup@0
            displayName: Install GitVersion
            inputs:
              versionSpec: '5.x'
          - task: gitversion/execute@0
            displayName: Determine Version
            inputs:
              useConfigFile: true
              configFilePath: 'GitVersion.yml'

          - task: UpdateBuildNumber@0
            displayName: Update Build Number
            inputs:
              buildNumber: DevOpsGitVersionTests $(Build.BuildNumber)

          - task: ATP.ATP-GitTag.GitTag.GitTag@5
            displayName: Create version tag in git for master builds
            inputs:
              tag: $(GitVersion.SemVer)
              forceTagCreation: true
              useLightweightTags: true
            condition: eq(variables['Build.SourceBranchName'], 'master')
